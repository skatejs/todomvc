<style>
  body {
    margin: 0;
    padding: 0;
  }
  x-differ {
    display: block;
  }
  .total {
    left: 0;
  }
  .total {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #acacac;
    padding: 10px 20px;
    position: absolute;
    z-index: 1;
  }
  .total input {
    background: transparent;
    border: 1px solid #acacac;
  }
  .total button, .total input {
    cursor: pointer;
  }
  .total input[type="number"]:focus {
    cursor: text;
  }
  .block {
    cursor: pointer;
    float: left;
  }
  .block:hover {
    background-color: green;
  }
  .active {
    background-color: grey;
  }
</style>
<script src="https://cdn.rawgit.com/skatejs/skatejs/0.14.1/dist/index.js"></script>
<script src="../dist/index.js"></script>
<script>
  var windowX = window.innerWidth;
  var windowY = window.innerHeight;
  var dd = window.skateDomDiff;
  var el = dd.vdom.element;
  var render = skateDomDiff.render(function (elem) {
    var total = elem.x * elem.y;
    var x = Math.floor(windowX / elem.x);
    var y = Math.floor(windowY / elem.y);
    var cont = el('div', { class: 'container' });

    if (!total) {
      return el('div');
    }

    for (var a = 0; a < total; a++) {
      var rand = Math.random() > (elem.threshold / 100);
      cont.childNodes.push(
        el('div', {
          class: 'block ' + (rand ? 'active' : ''),
          style: 'width: ' + x + 'px; height: ' + y + 'px'
        })
      );
    }

    return cont;
  });

  skate('x-differ', {
    properties: {
      threshold: skate.properties.number({
        attribute: true,
        default: 90
      }),
      x: skate.properties.number({
        attribute: true,
        default: 10
      }),
      y: skate.properties.number({
        attribute: true,
        default: 10
      })
    },
    prototype: {
      fps: function () {
        var delta;

        if (!this._lastCalledTime) {
          this._lastCalledTime = new Date().getTime();
        }

        if (!this._fpsArr) {
          this._fpsArr = [];
        }

        // Only average over a history of 10.
        if (this._fpsArr.length > 10) {
          this._fpsArr.shift();
        }

        delta = (new Date().getTime() - (this._lastCalledTime - 1)) / 1000;
        this._lastCalledTime = new Date().getTime();

        this._fpsArr.push(Math.ceil((1 / delta)));

        return Math.round(this._fpsArr.reduce(function (prev, curr) {
          return prev + curr;
        }) / this._fpsArr.length);
      }
    },
    attached: function (elem) {
      elem.interval = setInterval(function () {
        document.getElementById('fps').textContent = elem.fps();
        render(elem);
      });
    },
    detached: function (elem) {
      clearInterval(elem.interval);
    },
    render: render
  });
</script>
<div id="fps" style="position: absolute"></div>
<x-differ x="300" y="400" threshold="100"></x-differ>
